<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>BIM Sant√© Ultra</title>
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <style>
        :root {
            --bg: #f2f2f7; --card: #ffffff; --text: #1c1c1e; --text-dim: #8e8e93;
            --accent: #0a84ff; --bim-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --border: #e5e5ea; --success: #34c759;
        }
        @media (prefers-color-scheme: dark) {
            :root { --bg: #000; --card: #1c1c1e; --text: #fff; --border: #38383a; }
        }

        body { font-family: -apple-system, system-ui; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 100px; }
        .header { padding: 40px 20px 20px; text-align: center; background: var(--card); border-bottom: 1px solid var(--border); }
        .logo-img { width: 80px; border-radius: 12px; margin-bottom: 10px; }
        
        .tab-content { display: none; padding: 15px; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .widget, .meal-card { background: var(--card); padding: 20px; border-radius: 20px; margin-bottom: 15px; border: 1px solid var(--border); }
        h3 { margin: 0 0 15px 0; font-size: 1.1rem; color: var(--accent); }

        /* Form Logic Styles */
        .sub-section { margin: 10px 0; padding-left: 15px; border-left: 2px solid var(--accent); display: none; }
        .toggle-row { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border); }
        .multi-select { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .chip { background: var(--bg); border: 1px solid var(--border); padding: 8px; border-radius: 8px; font-size: 13px; text-align: center; }
        .chip input { display: none; }
        .chip input:checked + span { color: var(--accent); font-weight: bold; }

        select, input, textarea { 
            width: 100%; padding: 14px; background: var(--bg); border: 1px solid var(--border); 
            border-radius: 12px; color: var(--text); font-size: 16px; margin-top: 8px; box-sizing: border-box;
        }

        .nav-bar { position: fixed; bottom: 0; width: 100%; background: var(--card); display: flex; border-top: 1px solid var(--border); padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { flex: 1; text-align: center; padding: 15px; color: var(--text-dim); font-size: 10px; }
        .nav-item.active { color: var(--accent); font-weight: bold; }
        .btn-bim { background: var(--bim-gradient); color: white; border: none; padding: 18px; border-radius: 15px; width: 100%; font-weight: 800; font-size: 18px; margin-top: 15px; }
    </style>
</head>
<body>

    <div class="header">
        <img src="icons/icon-512.png" class="logo-img">
        <h1 style="margin:0; font-size: 1.2rem;">BIM SANT√â ‚Äî BENJAMIN</h1>
    </div>

    <div id="tab-home" class="tab-content active">
        <div class="widget">
            <h3>üìà Suivi de Progression</h3>
            <canvas id="weightChart" style="width:100%; height:180px;"></canvas>
        </div>
        <div id="history" class="widget"><h3>Historique</h3><div id="historyContent"></div></div>
    </div>

    <div id="tab-log" class="tab-content">
        <form id="ultraForm">
            <div class="meal-card">
                <h3>üò¥ Repos</h3>
                <input type="date" id="logDate" required>
                <input type="number" id="sleepHours" placeholder="Heures de sommeil (ex: 7.5)" step="0.5">
            </div>

            <div id="foodContainer"></div>

            <div class="meal-card">
                <h3>üèÉ Sport & Activit√©</h3>
                <div id="sportContainer"></div>
            </div>

            <div class="meal-card">
                <h3>‚öñÔ∏è Poids du jour</h3>
                <div style="display:flex; align-items:center; gap:10px;">
                    <select id="wK" style="flex:2"></select>
                    <span style="font-size:2rem; font-weight:bold;">,</span>
                    <select id="wG" style="flex:1"></select>
                </div>
            </div>

            <textarea id="comment" placeholder="Notes libres..."></textarea>
            <button type="submit" class="btn-bim">SAUVEGARDER MA JOURN√âE</button>
        </form>
    </div>

    <nav class="nav-bar">
        <div class="nav-item active" onclick="switchTab('home')">üè† ACCUEIL</div>
        <div class="nav-item" onclick="switchTab('log')">‚ûï SAISIR</div>
    </nav>

    <script>
        const DB = {
            meals: ['Petit-D√©jeuner', 'D√©jeuner', 'D√Æner'],
            categories: {
                'Entr√©e': ['Crudit√©s', 'Charcuterie', 'Soupe', 'Salade compos√©e'],
                'Plat': ['Prot√©ines', 'L√©gumes', 'F√©culents', 'Pain'],
                'Fromage': ['P√¢te dure', 'P√¢te molle', 'Fromage frais'],
                'Dessert': ['Fruit', 'Laitage', 'P√¢tisserie', 'Chocolat'],
                'Boisson': ['Eau', 'Alcool', 'Soda / Jus', 'Caf√© / Th√©']
            },
            items: {
                'Prot√©ines': ['Poulet', 'Dinde', 'Veau', 'B≈ìuf (Steak)', 'B≈ìuf (R√¥ti)', 'Agneau', 'Porc', 'Thon', 'Saumon', 'Cabillaud', 'Crevettes', '≈íufs (2)', '≈íufs (3)', 'Tofu', 'Jambon blanc', 'Jambon cru'],
                'L√©gumes': ['Brocolis', 'Haricots verts', '√âpinards', 'Courgettes', 'Carottes', 'Asperges', 'Aubergines', 'Poivrons', 'Salade verte', 'Tomates', 'Chou-fleur', 'Petits pois'],
                'F√©culents': ['Riz complet', 'P√¢tes', 'Quinoa', 'Pommes de terre', 'Lentilles', 'Pois chiches', 'Boulgour'],
                'Pain': ['1 morceau', '2 morceaux', '1/2 baguette', '1 baguette', 'Pain complet', 'Pain de mie (2 tr)'],
                'Alcool': ['Vin rouge (1v)', 'Vin blanc (1v)', 'Bi√®re (25cl)', 'Bi√®re (50cl)', 'Champagne', 'Whisky/Pastis'],
                'Sport': ['Musculation', 'Course √† pied', 'Rugby (Entra√Ænement)', 'Rugby (Match)', 'Marche active', 'V√©lo', 'Natation', 'Squash']
            }
        };

        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('tab-' + id).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Build Food Sections
            const fCont = document.getElementById('foodContainer');
            DB.meals.forEach(m => {
                let h = `<div class="meal-card"><h3>üç¥ ${m}</h3>`;
                Object.keys(DB.categories).forEach(cat => {
                    h += `
                        <div class="toggle-row"><span>${cat}</span><input type="checkbox" onchange="toggle('sub-${m}-${cat}', this.checked)"></div>
                        <div id="sub-${m}-${cat}" class="sub-section">
                            <div class="multi-select">
                                ${(DB.items[cat] || DB.categories[cat]).map(item => `
                                    <label class="chip"><input type="checkbox"><span>${item}</span></label>
                                `).join('')}
                            </div>
                            ${cat === 'Plat' ? `
                                <div style="margin-top:10px; font-weight:bold; font-size:12px;">Options avanc√©es :</div>
                                <div class="toggle-row"><span>Prot√©ines</span><input type="checkbox" onchange="toggle('p-${m}', this.checked)"></div>
                                <div id="p-${m}" class="sub-section"><div class="multi-select">${DB.items['Prot√©ines'].map(p=>`<label class="chip"><input type="checkbox"><span>${p}</span></label>`).join('')}</div></div>
                                <div class="toggle-row"><span>L√©gumes</span><input type="checkbox" onchange="toggle('l-${m}', this.checked)"></div>
                                <div id="l-${m}" class="sub-section"><div class="multi-select">${DB.items['L√©gumes'].map(l=>`<label class="chip"><input type="checkbox"><span>${l}</span></label>`).join('')}</div></div>
                                <div class="toggle-row"><span>Pain</span><input type="checkbox" onchange="toggle('pn-${m}', this.checked)"></div>
                                <div id="pn-${m}" class="sub-section"><div class="multi-select">${DB.items['Pain'].map(pn=>`<label class="chip"><input type="checkbox"><span>${pn}</span></label>`).join('')}</div></div>
                            ` : ''}
                        </div>`;
                });
                fCont.innerHTML += h + `</div>`;
            });

            // Build Sports
            const sCont = document.getElementById('sportContainer');
            DB.items['Sport'].forEach(s => {
                sCont.innerHTML += `<div class="toggle-row"><span>${s}</span><select style="width:100px; margin:0"><option value="">Non</option><option>15min</option><option>30min</option><option>45min</option><option>1h</option><option>1h30</option><option>2h+</option></select></div>`;
            });

            // Weight selects
            for(let i=60; i<=130; i++) document.getElementById('wK').innerHTML += `<option value="${i}">${i}</option>`;
            for(let i=0; i<=9; i++) document.getElementById('wG').innerHTML += `<option value="${i}">${i}</option>`;
            
            document.getElementById('logDate').valueAsDate = new Date();
        });

        function toggle(id, show) { document.getElementById(id).style.display = show ? 'block' : 'none'; }

        document.getElementById('ultraForm').onsubmit = (e) => {
            e.preventDefault();
            const date = document.getElementById('logDate').value;
            const weight = document.getElementById('wK').value + '.' + document.getElementById('wG').value;
            const data = JSON.parse(localStorage.getItem('bimUltraLogs') || '{}');
            data[date] = { weight, sleep: document.getElementById('sleepHours').value };
            localStorage.setItem('bimUltraLogs', JSON.stringify(data));
            alert("Donn√©es BIM enregistr√©es !");
            location.reload();
        };
    </script>
</body>
</html>
